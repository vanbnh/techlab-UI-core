import{ba as R,n as y,bh as A,r as p,a1 as u,j as e,bi as B,e as d,y as E,$ as S,R as C,C as g,a0 as F,f as H,b4 as I,a2 as Q}from"./index.21a02905.js";import{u as V}from"./useQuery.dce1140c.js";import{D as $}from"./index.2334fc13.js";import{S as q}from"./flatpickr.847007ce.js";import{B as z}from"./skeleton.dcca7ca8.js";import"./useMedia.3828616b.js";import{c as G}from"./index.65300432.js";import{S as J,a as K,b as U,C as W}from"./LineBrush.31ba0523.js";import"./index.cfee603e.js";const X=(n,o)=>n?Math.round((o-n)/n*100,2):0,Z=n=>Math.round(n.reduce((o,b)=>o+b,0)/n.length),ee=I.report.post.path,oe=()=>{var _;const{urls:n,keys:o,entries:b,statistic:N}=G,{search:O}=R(),{t:l}=y(),m=A(O),Y=(_=m==null?void 0:m.path)==null?void 0:_.split("/")[5],[i,x]=p.exports.useState({start_date:u().startOf("week").add("-8","week").format("YYYY-MM-DD"),end_date:u().endOf("week").format("YYYY-MM-DD")}),{data:r,isLoading:j}=V([o.statistic,m,i],async()=>await Q.get(n.statistic,{params:{post_id:Y,start_date:i.start_date,end_date:i.end_date}}).then(a=>a.data)),D=N.map(a=>({...a,value:a.key,label:a.name})),P=D.map(a=>({...a,label:l(a.label)})),[f,w]=p.exports.useState(D),T=f.map(a=>({...a,label:l(a.label)})),[t,L]=p.exports.useState({});return p.exports.useEffect(()=>{let a={};r&&r.length>0&&(a=f.reduce((h,s)=>(h[s.key]={...s,name:l(s.name),data:r.map(c=>[new Date(c.report_date).getTime(),c[s.key]]),last:r[r.length-1][s.key],change:X(r[0][s.key],r[r.length-1][s.key]),average:Z(r.map(c=>c[s.key]))},h),{})),L(a)},[r,f]),j?e(B,{}):d(E,{children:[e("div",{className:"mb-1",children:e(z,{data:{parentName:b,parentTo:ee,activeName:Y}})}),e(S,{children:e("div",{className:"p-1",children:d(C,{children:[e(g,{sm:"4",children:e($,{datePicker:i,setDatePicker:x})}),e(g,{sm:"8",children:e("div",{className:"w-100",children:e(q,{name:"location_report_chart",isMulti:!0,value:T,isClearable:!0,closeMenuOnSelect:!1,onChange:a=>w(a),options:P})})})]})})}),e(C,{children:Object.keys(t).map(a=>e(g,{md:"4",children:e(S,{children:e(F,{className:"p-0",children:e(J,{data:t[a]})})})},a))}),e(S,{className:"mt-2 table-responsive",children:d("table",{className:" table table-modern table-striped",children:[e("thead",{children:d("tr",{children:[e("th",{children:l("Name")}),e("th",{children:l("Last")}),e("th",{children:l("Average")}),e("th",{children:l("Percentage")}),d("th",{children:[u(i.start_date).format("DD/MM/YYYY")," -"," ",u(i.end_date).format("DD/MM/YYYY")]}),e("th",{children:l("Volume")})]})}),e("tbody",{children:Object.keys(t).map(a=>{var h,s,c,M,k,v;return d("tr",{children:[e("td",{children:(h=t[a])==null?void 0:h.name}),e("td",{children:(s=t[a])==null?void 0:s.last}),e("td",{children:(c=t[a])==null?void 0:c.average}),d("td",{className:H({"text-success":((M=t[a])==null?void 0:M.change)>0,"text-danger":((k=t[a])==null?void 0:k.change)<0}),children:[(v=t[a])==null?void 0:v.change,"%"]}),e("td",{children:e(K,{data:t[a]})}),e("td",{children:e(U,{data:t[a]})})]},a)})})]})}),e(C,{children:Object.keys(t).map(a=>e(g,{lg:"6",children:e(W,{data:t[a],dateRange:i})},a))})]})};export{oe as default};
