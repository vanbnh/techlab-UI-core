import{ba as R,n as y,bh as A,r as p,a1 as u,j as e,bi as B,e as d,y as E,$ as S,R as C,C as g,a0 as F,f as H,b4 as I,a2 as Q}from"./index.3dcf88af.js";import{u as V}from"./useQuery.f1204b34.js";import{D as $}from"./index.92319f09.js";import{S as q}from"./flatpickr.33727122.js";import{B as z}from"./skeleton.3213c32f.js";import"./useMedia.edd72064.js";import{c as G}from"./index.2f1b8313.js";import{S as J,a as K,b as U,C as W}from"./LineBrush.91260d43.js";import"./index.cfee603e.js";const X=(r,o)=>r?Math.round((o-r)/r*100,2):0,Z=r=>Math.round(r.reduce((o,b)=>o+b,0)/r.length),ee=I.report.location.path,oe=()=>{var _;const{urls:r,keys:o,entries:b,statistic:N}=G,{search:O}=R(),{t:l}=y(),m=A(O),Y=(_=m==null?void 0:m.path)==null?void 0:_.split("/")[3],[i,x]=p.exports.useState({start_date:u().startOf("week").add("-8","week").format("YYYY-MM-DD"),end_date:u().endOf("week").format("YYYY-MM-DD")}),{data:n,isLoading:j}=V([o.statistic,m,i],async()=>await Q.get(r.statistic,{params:{location_id:Y,start_date:i.start_date,end_date:i.end_date}}).then(a=>a.data)),D=N.map(a=>({...a,value:a.key,label:a.name})),w=D.map(a=>({...a,label:l(a.label)})),[f,L]=p.exports.useState(D),P=f.map(a=>({...a,label:l(a.label)})),[t,T]=p.exports.useState({});return p.exports.useEffect(()=>{let a={};n&&n.length>0&&(a=f.reduce((h,s)=>(h[s.key]={...s,name:l(s.name),data:n.map(c=>[new Date(c.report_date).getTime(),c[s.key]]),last:n[n.length-1][s.key],change:X(n[0][s.key],n[n.length-1][s.key]),average:Z(n.map(c=>c[s.key]))},h),{})),T(a)},[n,f]),j?e(B,{}):d(E,{children:[e("div",{className:"mb-1",children:e(z,{data:{parentName:b,parentTo:ee,activeName:Y}})}),e(S,{children:e("div",{className:"p-1",children:d(C,{children:[e(g,{sm:"3",children:e($,{datePicker:i,setDatePicker:x})}),e(g,{sm:"9",children:e("div",{className:"w-100",children:e(q,{name:"location_report_chart",isMulti:!0,value:P,isClearable:!0,closeMenuOnSelect:!1,onChange:a=>L(a),options:w})})})]})})}),e(C,{children:Object.keys(t).map(a=>e(g,{md:"4",children:e(S,{children:e(F,{className:"p-0",children:e(J,{data:t[a]})})})},a))}),e(S,{className:"mt-2 table-responsive",children:d("table",{className:" table table-modern table-striped",children:[e("thead",{children:d("tr",{children:[e("th",{children:l("Name")}),e("th",{children:l("Last")}),e("th",{children:l("Average")}),e("th",{children:l("Percentage")}),d("th",{children:[u(i.start_date).format("DD/MM/YYYY")," -"," ",u(i.end_date).format("DD/MM/YYYY")]}),e("th",{children:l("Volume")})]})}),e("tbody",{children:Object.keys(t).map(a=>{var h,s,c,M,k,v;return d("tr",{children:[e("td",{children:(h=t[a])==null?void 0:h.name}),e("td",{children:(s=t[a])==null?void 0:s.last}),e("td",{children:(c=t[a])==null?void 0:c.average}),d("td",{className:H({"text-success":((M=t[a])==null?void 0:M.change)>0,"text-danger":((k=t[a])==null?void 0:k.change)<0}),children:[(v=t[a])==null?void 0:v.change,"%"]}),e("td",{children:e(K,{data:t[a]})}),e("td",{children:e(U,{data:t[a]})})]},a)})})]})}),e(C,{children:Object.keys(t).map(a=>e(g,{lg:"6",children:e(W,{data:t[a],dateRange:i})},a))})]})};export{oe as default};
